<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pen Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <script src="scripts.js"></script>
</head>
<body>
    <div class="wrapper">
        <div class="widget plot">
            <div id="plot-title" class="widget-header">&nbsp;Wykres</div>
            <div class="widget-content">
                <div id="canvas-holder" class="canvas" style="position: relative;">
                    <canvas id="tracker" width="15" height="15" style="position: absolute; top: 0; left: 0;"></canvas>
                    <canvas id="canvas" style="position: absolute; top: 0; left: 0; right: 0; margin: auto;"></canvas>
                </div>
            </div>
        </div>

        <div class="settings-wrapper">
            <div class="widget settings">
                <div class="widget-header">&nbsp;Ustawienia wykresu</div>
                <div class="widget-content">
                    <div id="sizefix" class="input-field">
                        <div class="input-header"><b>ZABLOKUJ WIELKOŚĆ</b></div>
                        <input id="sizefix_in" type='checkbox' checked="checked">
                    </div>
                    <div class="input-field">
                        <div class="input-header"><b>TYP FUNKCJI</b></div>
                        <select id="functype">
                            <option id="square" value="square">FALA SQUARE</option>
                            <option id="sine" value="sine">SINUSOIDA</option>
                            <option id="parabola" value="parabola">PARABOLA</option>
                            <option id="linear" value="linear">PROSTA</option>
                            <option id="spiral" value="spiral">SPIRALA</option>
                        </select>
                    </div>
                    <div id="speed" class="input-field">
                        <div class="input-header"><b>PRĘDKOŚĆ PUNKTU</b></div>
                        <select id="speed_in">
                            <option value="low">NISKA</option>
                            <option value="medium" selected="selected">ŚREDNIA</option>
                            <option value="high">WYSOKA</option>
                        </select>
                    </div>
                    <div class="widget-content" style="display: none;">
                        <div id="rand" class="input-field">
                            <div class="input-header"><b>Szansa zmiany prędkości</b></div>
                            <input id="rand_in" type='range' min='0' max='100' value="20">
                            <div id="rand_display" style="float: left;">20%</div>
                        </div>
                    </div>
                    <div id="composite" class="input-field">
                        <div class="input-header"><b>DODAJ SKOKI</b></div>
                        <input id="composite_in" type='checkbox'>
                    </div>
                    <div id="freq" class="input-field">
                        <div class="input-header"><b>CZĘSTOTLIWOŚĆ</b></div>
                        <input id="freq_in" type='range' min='1' max='15' step="0.1" value="5">
                        <div id="freq_display" style="float: left;">5</div>
                    </div>
                    <div id="amp" class="input-field">
                        <div class="input-header"><b>AMPLITUDA</b></div>
                        <input id="amp_in" type='range' min='0' max='10' step="0.1" value="5">
                        <div id="amp_display" style="float: left;">5</div>
                    </div>
                    <div id="a" class="input-field">
                        <div class="input-header"><b>A</b></div>
                        <input id="a_in" type='number' step="0.01">
                    </div>
                    <div id="b" class="input-field">
                        <div class="input-header"><b>B</b></div>
                        <input id="b_in" type='number' step="0.01">
                    </div>
                    <div id="c" class="input-field">
                        <div class="input-header"><b>C</b></div>
                        <input id="c_in" type='number' step="0.01">
                    </div>
                    <div id="alpha" class="input-field">
                        <div class="input-header"><b>SZEROKOŚĆ SPIRALI</b></div>
                        <input id="alpha_in" type='range' min='0.15' max='0.25' step="0.01" value="0.2">
                        <div id="alpha_display" style="float: left;">0.2</div>
                    </div>
                    <div id="length" class="input-field">
                        <div class="input-header"><b>DŁUGOŚĆ SKOKU</b></div>
                        <input id="length_in" type='range' min='10' max='30' step="1" value="20">
                        <div id="length_display" style="float: left;">20</div>
                    </div><br/>
                    
                    <div class="input-field">
                        <button id="start">ROZPOCZNIJ</button>
                    </div>
    
                    <div class="input-field">
                        <button id="download">POBIERZ WYNIK</button>
                        <div id="download-error" class="input-header" style="color: red;"></div>
                    </div>
                </div>
            </div>
    
            <div class="widget settings" style="height: fit-content;">
                <div class="widget-header">&nbsp;Skróty klawiszowe</div>
                <div class="widget-content">
                    <div class="input-field">
                        <div class="instruction-holder">
                            <div class="instruction-key">L</div>
                            <div class="instruction-action">ZABLOKUJ WIELKOŚĆ</div>
                        </div>
                        <div class="instruction-holder">
                            <div class="instruction-key">1</div>
                            <div class="instruction-action">FALA SQUARE</div>
                        </div>
                        <div class="instruction-holder">
                            <div class="instruction-key">2</div>
                            <div class="instruction-action">SINUSOIDA</div>
                        </div>
                        <div class="instruction-holder">
                            <div class="instruction-key">3</div>
                            <div class="instruction-action">PARABOLA</div>
                        </div>
                        <div class="instruction-holder">
                            <div class="instruction-key">4</div>
                            <div class="instruction-action">PROSTA</div>
                        </div>
                        <div class="instruction-holder">
                            <div class="instruction-key">5</div>
                            <div class="instruction-action">SPIRALA</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="result-widget" class="widget plot" style="display: none;">
            <div class="widget-header">&nbsp;Wynik</div>
            <div class="widget-content">
                <div class="canvas" style="position: relative; width: 800px; height: 400px">
                    <canvas id="result" width="800" height="400" style="position: absolute; top: 0; left: 0; right: 0; margin: auto;"></canvas>
                </div>
            </div>
        </div>
    </div><br /><br />

    <script>
        // GRAB ELEMENTS USED FOR GRAPHING
        const canvas = document.getElementById("canvas");
        const canvas_holder = document.getElementById("canvas-holder");
        const result = document.getElementById("result");
        const tracker = document.getElementById("tracker");
        const tracker_ctx = tracker.getContext("2d");
        tracker_ctx.arc(7.5, 7.5, 7.5, 0, 2 * Math.PI);
        tracker_ctx.fillStyle = "black";
        tracker_ctx.fill();
        
        // INITIALIZE PARAMS
        let unit = canvas.height / 10;
        const point_frequency = 1000;
        var sizefix = true;
        var func_type = "square";
        var domain = 20, freq = 5, amp = 2;
        var coeff_a = 1, coeff_b = 1, coeff_c = 1, alpha = 0.2, composite = false, length = 20;
        var speed = 1, rand = 0.2;
        var records = [];
        
        // RESIZE CANVAS TO SCREEN SIZE
        window.addEventListener('resize', resizeCanvas, false);
        window.addEventListener('load', resizeCanvas, false);
        function resizeCanvas() {
            if (sizefix){
                canvas.width = 800;
                canvas.height = 400;
            } else {
                canvas.width = window.innerWidth * 0.7;
                canvas.height = canvas.width * 0.5;
            }

            canvas_holder.style.width = `${canvas.width}px`;
            canvas_holder.style.height = `${canvas.height}px`;
            unit = canvas.height / 10;

            DisplaySettings(func_type);
            data = GeneratePoints(func_type, domain, freq, amp);
            PlotPoints(canvas, data, domain, unit, tracker);
        }
        
        // KEYBOARD SHORTCUTS
        document.addEventListener('keydown', function(event) {
            switch(event.keyCode){
                case 49: // 1
                    func_type = "square";
                    break;
                case 50: // 2
                    func_type = "sine";
                    break;
                case 51: // 3
                    func_type = "parabola";
                    break;
                case 52: // 4
                    func_type = "linear";
                    break;
                case 53: // 5
                    func_type = "spiral";
                    break;
                case 76: // L
                    sizefix = !sizefix;
                    document.getElementById("sizefix_in").checked = sizefix;
                    resizeCanvas();
                    break;
            }
            document.getElementById(func_type).selected = "selected";
            if (composite) DisplaySettings("spiral-composite");
            else DisplaySettings(func_type);
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        });

        // LISTEN FOR SETTING CHANGES
        document.getElementById("sizefix").oninput = function(){
            sizefix = !sizefix;
            resizeCanvas();
            DisplaySettings(func_type);
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };

        document.getElementById("functype").oninput = function(){
            func_type = this.value;
            DisplaySettings(func_type);
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };
        
        document.getElementById("freq_in").oninput = function() {
            freq = this.value;
            document.getElementById("freq_display").innerHTML = freq;
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };
        
        document.getElementById("amp_in").oninput = function() {
            amp = this.value;
            document.getElementById("amp_display").innerHTML = amp;
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };
        
        document.getElementById("a_in").oninput = function() {
            coeff_a = this.value;
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };
        
        document.getElementById("b_in").oninput = function() {
            coeff_b = this.value;
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };
        
        document.getElementById("c_in").oninput = function() {
            coeff_c = this.value;
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };
        
        document.getElementById("alpha_in").oninput = function() {
            alpha = this.value;
            document.getElementById("alpha_display").innerHTML = alpha;
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };
        
        document.getElementById("composite_in").oninput = function() {
            composite = !composite;
            if (composite) DisplaySettings("spiral-composite");
            else DisplaySettings(func_type);
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };
        
        document.getElementById("length_in").oninput = function() {
            length = this.value;
            document.getElementById("length_display").innerHTML = length;
            data = GeneratePoints(func_type, domain, freq, amp, coeff_a, coeff_b, coeff_c, alpha, composite, length);
            PlotPoints(canvas, data, domain, unit, tracker);
        };

        document.getElementById("speed_in").oninput = function() {
            speed = this.value;
            switch(speed){
                case "low":
                    speed = 0.5;
                    break;

                case "medium":
                    speed = 1;
                    break;

                case "high":
                    speed = 2;
                    break;
            }
        };

        document.getElementById("rand_in").oninput = function() {
            rand = this.value;
            document.getElementById("rand_display").innerHTML = rand + "%";
        };
        
        // START TEST
        const start_test = document.getElementById("start");
        start_test.addEventListener('click', async function(){
            records = [];
            scroll(0,0);
            await StartTracker(records, canvas, tracker, data, speed, unit, func_type, amp / 2, 2 * Math.PI * freq / domain);
            document.getElementById("result-widget").style.display = "block";
            PlotResults(result, records, unit);
        });

        // GENERATE CSV FOR DOWNLOAD
        var download = document.getElementById("download");
        download.addEventListener("click", function(){
            if (records.length > 0) {
                document.getElementById("download-error").innerHTML = "";
                csv = ArrayToCSV(records);
                DownloadCSV(csv, 'records.csv');
            } else {
                document.getElementById("download-error").innerHTML = "Brak danych do pobrania";
            }
        });
        </script>
</body>
</html>
